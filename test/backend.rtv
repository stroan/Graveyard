 -----------------------------------------------
-- Backend
-----------------------------------------------

basetype Bool "bool" = Bool String "$1$";
basetype Int "int" = Int Integer "$1$";
baseside SideEffect "TRIANGLE void";

basetype Float4 "float4" = Float4 Real Real Real Real "float4($1$,$2$,$3$,$4$)";
basetype Float2 "float2" = Float2 Real Real "float2($1$,$2$)";
basetype Float "float" = Float Real "$1$";
basetype Matrix44 "matrix44";
basetype Texture "texture";
basetype Sampler "sampler" = Sampler String "sampler_state{Texture = <$1$>;mipfilter = Linear;AddressU = Clamp;AddressV = Clamp;}";

basetype Float4Array "AttribArray<float4>";

basefunc mulF4M4 :: Float4 -> Matrix44 -> Float4 "mul($1$,$2$)";
basefunc mulFF4 :: Float -> Float4 -> Float4 "mul($1$,$2$)";
basefunc addF4 :: Float4 -> Float4 -> Float4 "($1$ + $2$)";
basefunc tex2D :: Sampler -> Float2 -> Float4 "tex2D($1$, $2$)";
basefunc inormF4 :: Float4 -> Float4 "normalize($1$)";

basefunc dotF4 :: Float4 -> Float4 -> Float "dot($1$,$2$)";

basefunc restartStrip :: SideEffect "restartStrip()";
basefunc restartStrip2 :: SideEffect "restartStrip2()";
basefunc nullOp :: SideEffect "";

basefunc inF4A :: Float4Array -> Int -> Float4 "$1$[$2$]";

basefunc eqf4 :: Float4 -> Float4 -> Bool "$1$ == $2$";
basefunc eqI :: Int -> Int -> Bool "$1$ == $2$";

semantic Position a = Pos a "POSITION";
semantic Normal a = Norm a "NORMAL";
semantic Color a = Col a "COLOR";

true = Bool "true";
false = Bool "false";

-----------------------------------------------
-- Utils
-----------------------------------------------

data NormalisedF4 = NF4 Float4;
data Clamped = Clamped Float;

norm a = NF4 (inormF4 a);

dotN (NF4 a) (NF4 b) = Clamped (dotF4 a b);
mulCF4 (Clamped a) b = mulFF4 a b;
saturateC (Clamped a) = Clamped a;

getNF :: NormalisedF4 -> Float4;
getNF (NF4 a) = a;